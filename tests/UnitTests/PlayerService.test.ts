import { PlayerService } from '../../src/Infrastructure/implementations/AppServices/PlayerServiceImpl.js';
import { IVector2DRepository } from "../../src/domainService/IVector2D.js";
import { PlayerBuilder } from '../Builders/PlayerBuilder.js';
import { IDirection } from "../../src/domain/game/Direction.js";

const vector2DRepository: IVector2DRepository = {
    multiply: jest.fn(),
    normalize: jest.fn(),
    magnitude: jest.fn(),
    dotproduct: jest.fn(),
    normal: jest.fn(),
    copy: jest.fn()

};

describe('PlayerService', () => {
    describe('applyForce', () => {
        test('apply Force to player', () => {

            // Arrange  
            const player = new PlayerBuilder()
                .build();
            const force: IDirection = { x: 2, y: 3 };

            const playerService = new PlayerService(vector2DRepository)

            // Act
            playerService.applyForce(player,force)


            // Assert
            expect(player.velocity).toEqual({ x: 2, y: 3 });

        });
    })
    describe('calculatePolygonCentroid', () => {
        test('calculate Polygon Centroid', () => {

            // Arrange  
            const player = new PlayerBuilder()
                .setCurNsides(55)
                .setCoordinates(
                    [
                        { x: 820.6422536591209, y: 1085.5954239148205 },
                        { x: 820.3179048100648, y: 1091.267636470974 },
                        { x: 819.3490866461714, y: 1096.8659030619265 },
                        { x: 817.7484291938237, y: 1102.3172417212204 },
                        { x: 815.5367994708029, y: 1107.5505859126833 },
                        { x: 812.7430294528004, y: 1112.497710991411 },
                        { x: 809.4035402045216, y: 1117.0941236163499 },
                        { x: 805.5618670754083, y: 1121.2799025196266 },
                        { x: 801.2680921497802, y: 1125.000479671913 },
                        { x: 796.5781913502756, y: 1128.2073516601397 },
                        { x: 791.5533047060947, y: 1130.8587120036614 },
                        { x: 786.258939299218, y: 1132.9199961656673 },
                        { x: 780.764115279413, y: 1134.3643321547781 },
                        { x: 775.1404660810277, y: 1135.172890842548 },
                        { x: 769.4613045716263, y: 1135.3351314299512 },
                        { x: 763.8006673066419, y: 1134.8489388628154 },
                        { x: 758.2323493496526, y: 1133.7206514047898 },
                        { x: 752.8289422408727, y: 1131.964978008382 },
                        { x: 747.6608876554111, y: 1129.6048065612715 },
                        { x: 742.7955590883104, y: 1126.6709055076878 },
                        { x: 738.2963835380033, y: 1123.2015227346883 },
                        { x: 734.222014638391, y: 1119.2418869524554 },
                        { x: 730.6255680190235, y: 1114.8436180688939 },
                        { x: 727.5539288616408, y: 1110.0640542451856 },
                        { x: 725.047140680126, y: 1104.9655044051738 },
                        { x: 723.1378832920636, y: 1099.61443594325 },
                        { x: 721.8510467873398, y: 1094.08060822022 },
                        { x: 721.2034070477564, y: 1088.436163143352 },
                        { x: 721.2034070477564, y: 1082.7546846862892 },
                        { x: 721.8510467873397, y: 1077.1102396094213 },
                        { x: 723.1378832920635, y: 1071.5764118863913 },
                        { x: 725.0471406801258, y: 1066.2253434244674 },
                        { x: 727.5539288616407, y: 1061.1267935844555 },
                        { x: 730.6255680190234, y: 1056.3472297607473 },
                        { x: 734.2220146383908, y: 1051.9489608771858 },
                        { x: 738.2963835380032, y: 1047.9893250949528 },
                        { x: 742.79555908831, y: 1044.5199423219533 },
                        { x: 747.6608876554108, y: 1041.5860412683696 },
                        { x: 752.8289422408723, y: 1039.2258698212588 },
                        { x: 758.2323493496523, y: 1037.4701964248513 },
                        { x: 763.8006673066417, y: 1036.3419089668255 },
                        { x: 769.4613045716259, y: 1035.8557163996898 },
                        { x: 775.1404660810274, y: 1036.017956987093 },
                        { x: 780.7641152794127, y: 1036.8265156748628 },
                        { x: 786.2589392992179, y: 1038.2708516639736 },
                        { x: 791.5533047060944, y: 1040.3321358259793 },
                        { x: 796.5781913502752, y: 1042.983496169501 },
                        { x: 801.2680921497799, y: 1046.1903681577278 },
                        { x: 805.561867075408, y: 1049.910945310014 },
                        { x: 809.4035402045214, y: 1054.0967242132908 },
                        { x: 812.7430294528002, y: 1058.6931368382295 },
                        { x: 815.5367994708027, y: 1063.6402619169573 },
                        { x: 817.7484291938235, y: 1068.8736061084203 },
                        { x: 819.3490866461714, y: 1074.324944767714 },
                        { x: 820.3179048100648, y: 1079.9232113586668 }
                    ]
                )
                .build();

            const playerService = new PlayerService(vector2DRepository)

            // Act
            const result = playerService.calculatePolygonCentroid(player)


            // Assert
            expect(result).toEqual({ x: 770.8822536591205, y: 1085.5954239148207 });

        });
    })
    describe('calculateCircumcircleRadius', () => {
        test('calculate Circumcircle Radius', () => {

            // Arrange  
            const player = new PlayerBuilder()
                .setCurNsides(55)
                .build()

            const square: number = 7799;
            const playerService = new PlayerService(vector2DRepository)

            // Act
            const result = playerService.calculateCircumcircleRadius(player, square)


            // Assert
            expect(Math.floor(result)).toEqual(49);

        });

    });
    describe('calculatePolygonArea', () => {
        test('calculate Polygon Area of player', () => {

            // Arrange  
            const player = new PlayerBuilder()
                .setNsides(55)
                .setCoordinates(
                    [
                        { x: 820.6422536591209, y: 1085.5954239148205 },
                        { x: 820.3179048100648, y: 1091.267636470974 },
                        { x: 819.3490866461714, y: 1096.8659030619265 },
                        { x: 817.7484291938237, y: 1102.3172417212204 },
                        { x: 815.5367994708029, y: 1107.5505859126833 },
                        { x: 812.7430294528004, y: 1112.497710991411 },
                        { x: 809.4035402045216, y: 1117.0941236163499 },
                        { x: 805.5618670754083, y: 1121.2799025196266 },
                        { x: 801.2680921497802, y: 1125.000479671913 },
                        { x: 796.5781913502756, y: 1128.2073516601397 },
                        { x: 791.5533047060947, y: 1130.8587120036614 },
                        { x: 786.258939299218, y: 1132.9199961656673 },
                        { x: 780.764115279413, y: 1134.3643321547781 },
                        { x: 775.1404660810277, y: 1135.172890842548 },
                        { x: 769.4613045716263, y: 1135.3351314299512 },
                        { x: 763.8006673066419, y: 1134.8489388628154 },
                        { x: 758.2323493496526, y: 1133.7206514047898 },
                        { x: 752.8289422408727, y: 1131.964978008382 },
                        { x: 747.6608876554111, y: 1129.6048065612715 },
                        { x: 742.7955590883104, y: 1126.6709055076878 },
                        { x: 738.2963835380033, y: 1123.2015227346883 },
                        { x: 734.222014638391, y: 1119.2418869524554 },
                        { x: 730.6255680190235, y: 1114.8436180688939 },
                        { x: 727.5539288616408, y: 1110.0640542451856 },
                        { x: 725.047140680126, y: 1104.9655044051738 },
                        { x: 723.1378832920636, y: 1099.61443594325 },
                        { x: 721.8510467873398, y: 1094.08060822022 },
                        { x: 721.2034070477564, y: 1088.436163143352 },
                        { x: 721.2034070477564, y: 1082.7546846862892 },
                        { x: 721.8510467873397, y: 1077.1102396094213 },
                        { x: 723.1378832920635, y: 1071.5764118863913 },
                        { x: 725.0471406801258, y: 1066.2253434244674 },
                        { x: 727.5539288616407, y: 1061.1267935844555 },
                        { x: 730.6255680190234, y: 1056.3472297607473 },
                        { x: 734.2220146383908, y: 1051.9489608771858 },
                        { x: 738.2963835380032, y: 1047.9893250949528 },
                        { x: 742.79555908831, y: 1044.5199423219533 },
                        { x: 747.6608876554108, y: 1041.5860412683696 },
                        { x: 752.8289422408723, y: 1039.2258698212588 },
                        { x: 758.2323493496523, y: 1037.4701964248513 },
                        { x: 763.8006673066417, y: 1036.3419089668255 },
                        { x: 769.4613045716259, y: 1035.8557163996898 },
                        { x: 775.1404660810274, y: 1036.017956987093 },
                        { x: 780.7641152794127, y: 1036.8265156748628 },
                        { x: 786.2589392992179, y: 1038.2708516639736 },
                        { x: 791.5533047060944, y: 1040.3321358259793 },
                        { x: 796.5781913502752, y: 1042.983496169501 },
                        { x: 801.2680921497799, y: 1046.1903681577278 },
                        { x: 805.561867075408, y: 1049.910945310014 },
                        { x: 809.4035402045214, y: 1054.0967242132908 },
                        { x: 812.7430294528002, y: 1058.6931368382295 },
                        { x: 815.5367994708027, y: 1063.6402619169573 },
                        { x: 817.7484291938235, y: 1068.8736061084203 },
                        { x: 819.3490866461714, y: 1074.324944767714 },
                        { x: 820.3179048100648, y: 1079.9232113586668 }
                    ]
                )
                .build();

            const playerService = new PlayerService(vector2DRepository)

            // Act
            const result = playerService.calculatePolygonArea(player)


            // Assert
            expect(Math.floor(result)).toEqual(7761);

        });

    });


    describe('GetAngles', () => {
        const angles = [

            0.11423973285781445,
            0.11423973285780666,
            0.11423973285781153,
            0.11423973285781153,
            0.11423973285780568,
            0.11423973285781153,
            0.11423973285781347,
            0.11423973285781153,
            0.11423973285780958,
            0.11423973285780958,
            0.11423973285781153,
            0.11423973285781153,
            0.11423973285781153,
            0.11423973285780958,
            0.11423973285781347,
            0.11423973285781153,
            0.11423973285780958,
            0.11423973285781056,
            0.11423973285780666,
            0.11423973285781153,
            0.11423973285781153,
            0.1142397328578086,
            0.11423973285781153,
            0.11423973285780958,
            0.11423973285780568,
            0.1142397328578086,
            0.11423973285781445,
            0.11423973285780958,
            0.1142397328578086,
            0.11423973285781056,
            0.11423973285781153,
            0.11423973285780958,
            0.11423973285781153,
            0.11423973285780666,
            0.11423973285781347,
            0.11423973285780666,
            0.11423973285780666,
            0.11423973285780958,
            0.11423973285780958,
            0.11423973285781543,
            0.1142397328578086,
            0.11423973285781347,
            0.11423973285781347,
            0.11423973285781347,
            0.11423973285780958,
            0.11423973285780958,
            0.11423973285781347,
            0.11423973285781347,
            0.11423973285781347,
            0.1142397328578086,
            0.11423973285781153,
            0.11423973285781153,
            0.11423973285780958,
            0.11423973285781347,
            0.11423973285781931,

        ]
        test('Get Angles of Polygon', () => {

            // Arrange  
            const player = new PlayerBuilder()
                .setCentroid({ x: 770.8822536591209, y: 1085.5954239148205 })
                .setCurNsides(55)
                .setCoordinates(
                    [
                        { x: 820.6422536591209, y: 1085.5954239148205 },
                        { x: 820.3179048100648, y: 1091.267636470974 },
                        { x: 819.3490866461714, y: 1096.8659030619265 },
                        { x: 817.7484291938237, y: 1102.3172417212204 },
                        { x: 815.5367994708029, y: 1107.5505859126833 },
                        { x: 812.7430294528004, y: 1112.497710991411 },
                        { x: 809.4035402045216, y: 1117.0941236163499 },
                        { x: 805.5618670754083, y: 1121.2799025196266 },
                        { x: 801.2680921497802, y: 1125.000479671913 },
                        { x: 796.5781913502756, y: 1128.2073516601397 },
                        { x: 791.5533047060947, y: 1130.8587120036614 },
                        { x: 786.258939299218, y: 1132.9199961656673 },
                        { x: 780.764115279413, y: 1134.3643321547781 },
                        { x: 775.1404660810277, y: 1135.172890842548 },
                        { x: 769.4613045716263, y: 1135.3351314299512 },
                        { x: 763.8006673066419, y: 1134.8489388628154 },
                        { x: 758.2323493496526, y: 1133.7206514047898 },
                        { x: 752.8289422408727, y: 1131.964978008382 },
                        { x: 747.6608876554111, y: 1129.6048065612715 },
                        { x: 742.7955590883104, y: 1126.6709055076878 },
                        { x: 738.2963835380033, y: 1123.2015227346883 },
                        { x: 734.222014638391, y: 1119.2418869524554 },
                        { x: 730.6255680190235, y: 1114.8436180688939 },
                        { x: 727.5539288616408, y: 1110.0640542451856 },
                        { x: 725.047140680126, y: 1104.9655044051738 },
                        { x: 723.1378832920636, y: 1099.61443594325 },
                        { x: 721.8510467873398, y: 1094.08060822022 },
                        { x: 721.2034070477564, y: 1088.436163143352 },
                        { x: 721.2034070477564, y: 1082.7546846862892 },
                        { x: 721.8510467873397, y: 1077.1102396094213 },
                        { x: 723.1378832920635, y: 1071.5764118863913 },
                        { x: 725.0471406801258, y: 1066.2253434244674 },
                        { x: 727.5539288616407, y: 1061.1267935844555 },
                        { x: 730.6255680190234, y: 1056.3472297607473 },
                        { x: 734.2220146383908, y: 1051.9489608771858 },
                        { x: 738.2963835380032, y: 1047.9893250949528 },
                        { x: 742.79555908831, y: 1044.5199423219533 },
                        { x: 747.6608876554108, y: 1041.5860412683696 },
                        { x: 752.8289422408723, y: 1039.2258698212588 },
                        { x: 758.2323493496523, y: 1037.4701964248513 },
                        { x: 763.8006673066417, y: 1036.3419089668255 },
                        { x: 769.4613045716259, y: 1035.8557163996898 },
                        { x: 775.1404660810274, y: 1036.017956987093 },
                        { x: 780.7641152794127, y: 1036.8265156748628 },
                        { x: 786.2589392992179, y: 1038.2708516639736 },
                        { x: 791.5533047060944, y: 1040.3321358259793 },
                        { x: 796.5781913502752, y: 1042.983496169501 },
                        { x: 801.2680921497799, y: 1046.1903681577278 },
                        { x: 805.561867075408, y: 1049.910945310014 },
                        { x: 809.4035402045214, y: 1054.0967242132908 },
                        { x: 812.7430294528002, y: 1058.6931368382295 },
                        { x: 815.5367994708027, y: 1063.6402619169573 },
                        { x: 817.7484291938235, y: 1068.8736061084203 },
                        { x: 819.3490866461714, y: 1074.324944767714 },
                        { x: 820.3179048100648, y: 1079.9232113586668 }
                    ]
                )
                .build();

            const playerService = new PlayerService(vector2DRepository)

            // Act
            const result = playerService.GetAngles(player)


            // Assert
            expect(result).toEqual(angles);

        });

    });
    describe('GetRayDistances', () => {
        const RayDistances = [

            49.75999999999999,
            49.76,
            49.759999999999934,
            49.760000000000026,
            49.76000000000004,
            49.75999999999993,
            49.75999999999998,
            49.76000000000005,
            49.75999999999993,
            49.7600000000001,
            49.76000000000001,
            49.759999999999884,
            49.76000000000014,
            49.759999999999984,
            49.76000000000001,
            49.75999999999981,
            49.76000000000006,
            49.759999999999906,
            49.75999999999998,
            49.75999999999986,
            49.760000000000126,
            49.759999999999835,
            49.76000000000001,
            49.75999999999999,
            49.759999999999984,
            49.75999999999993,
            49.75999999999998,
            49.76000000000001,
            49.76,
            49.760000000000005,
            49.75999999999991,
            49.760000000000005,
            49.75999999999998,
            49.75999999999997,
            49.75999999999985,
            49.760000000000026,
            49.75999999999987,
            49.759999999999934,
            49.76000000000007,
            49.75999999999993,
            49.75999999999985,
            49.760000000000026,
            49.759999999999955,
            49.76000000000009,
            49.75999999999985,
            49.760000000000126,
            49.76000000000011,
            49.75999999999997,
            49.76000000000005,
            49.75999999999994,
            49.759999999999984,
            49.76000000000004,
            49.76,
            49.76000000000004,
            49.760000000000026

        ]
        test('Get Ray Distances of polygon', () => {

            // Arrange  
            const player = new PlayerBuilder()
                .setCentroid({ x: 770.8822536591209, y: 1085.5954239148205 })
                .setCurNsides(55)
                .setCoordinates(
                    [
                        { x: 820.6422536591209, y: 1085.5954239148205 },
                        { x: 820.3179048100648, y: 1091.267636470974 },
                        { x: 819.3490866461714, y: 1096.8659030619265 },
                        { x: 817.7484291938237, y: 1102.3172417212204 },
                        { x: 815.5367994708029, y: 1107.5505859126833 },
                        { x: 812.7430294528004, y: 1112.497710991411 },
                        { x: 809.4035402045216, y: 1117.0941236163499 },
                        { x: 805.5618670754083, y: 1121.2799025196266 },
                        { x: 801.2680921497802, y: 1125.000479671913 },
                        { x: 796.5781913502756, y: 1128.2073516601397 },
                        { x: 791.5533047060947, y: 1130.8587120036614 },
                        { x: 786.258939299218, y: 1132.9199961656673 },
                        { x: 780.764115279413, y: 1134.3643321547781 },
                        { x: 775.1404660810277, y: 1135.172890842548 },
                        { x: 769.4613045716263, y: 1135.3351314299512 },
                        { x: 763.8006673066419, y: 1134.8489388628154 },
                        { x: 758.2323493496526, y: 1133.7206514047898 },
                        { x: 752.8289422408727, y: 1131.964978008382 },
                        { x: 747.6608876554111, y: 1129.6048065612715 },
                        { x: 742.7955590883104, y: 1126.6709055076878 },
                        { x: 738.2963835380033, y: 1123.2015227346883 },
                        { x: 734.222014638391, y: 1119.2418869524554 },
                        { x: 730.6255680190235, y: 1114.8436180688939 },
                        { x: 727.5539288616408, y: 1110.0640542451856 },
                        { x: 725.047140680126, y: 1104.9655044051738 },
                        { x: 723.1378832920636, y: 1099.61443594325 },
                        { x: 721.8510467873398, y: 1094.08060822022 },
                        { x: 721.2034070477564, y: 1088.436163143352 },
                        { x: 721.2034070477564, y: 1082.7546846862892 },
                        { x: 721.8510467873397, y: 1077.1102396094213 },
                        { x: 723.1378832920635, y: 1071.5764118863913 },
                        { x: 725.0471406801258, y: 1066.2253434244674 },
                        { x: 727.5539288616407, y: 1061.1267935844555 },
                        { x: 730.6255680190234, y: 1056.3472297607473 },
                        { x: 734.2220146383908, y: 1051.9489608771858 },
                        { x: 738.2963835380032, y: 1047.9893250949528 },
                        { x: 742.79555908831, y: 1044.5199423219533 },
                        { x: 747.6608876554108, y: 1041.5860412683696 },
                        { x: 752.8289422408723, y: 1039.2258698212588 },
                        { x: 758.2323493496523, y: 1037.4701964248513 },
                        { x: 763.8006673066417, y: 1036.3419089668255 },
                        { x: 769.4613045716259, y: 1035.8557163996898 },
                        { x: 775.1404660810274, y: 1036.017956987093 },
                        { x: 780.7641152794127, y: 1036.8265156748628 },
                        { x: 786.2589392992179, y: 1038.2708516639736 },
                        { x: 791.5533047060944, y: 1040.3321358259793 },
                        { x: 796.5781913502752, y: 1042.983496169501 },
                        { x: 801.2680921497799, y: 1046.1903681577278 },
                        { x: 805.561867075408, y: 1049.910945310014 },
                        { x: 809.4035402045214, y: 1054.0967242132908 },
                        { x: 812.7430294528002, y: 1058.6931368382295 },
                        { x: 815.5367994708027, y: 1063.6402619169573 },
                        { x: 817.7484291938235, y: 1068.8736061084203 },
                        { x: 819.3490866461714, y: 1074.324944767714 },
                        { x: 820.3179048100648, y: 1079.9232113586668 }
                    ]
                )
                .build();

            const playerService = new PlayerService(vector2DRepository)

            // Act
            const result = playerService.GetRayDistances(player)


            // Assert
            expect(result).toEqual(RayDistances);

        });

    });
}); 
