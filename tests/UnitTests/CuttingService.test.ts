import { CuttingService } from '../../src/Infrastructure/implementations/AppServices/CuttingServiceImpl.js';
import { IVector2D } from '../../src/domain/game/Vector2D.js';
import { PlayerBuilder } from '../Builders/PlayerBuilder.js';
import { LineBuilder } from '../Builders/LineBuilder.js';



describe('CuttingService', () => {
    describe('splitPolygon', () => {
        const Bigpoly: any = [
            { x: 1023.0968206437487, y: 1749.9952829404767 },
            { x: 1022.7725012335452, y: 1755.6706686500868 },
            { x: 1021.8037655272152, y: 1761.2721628403867 },
            { x: 1020.2007911398557, y: 1766.7336637725787 },
            { x: 1017.9885245438655, y: 1771.9701762132158 },
            { x: 1015.1902091940294, y: 1776.9266820915273 },
            { x: 1011.8493941933078, y: 1781.5260452173998 },
            { x: 1008.0063778957731, y: 1785.71488894444 },
            { x: 1003.6688092888228, y: 1789.3955954544365 },
            { x: 999.0135608340503, y: 1792.6526692220684 },
            { x: 993.9865828149626, y: 1795.3068504570806 },
            { x: 988.6830775315498, y: 1797.3733332244117 },
            { x: 983.1784771676884, y: 1798.821398883504 },
            { x: 977.5518545245188, y: 1799.6315245923006 },
            { x: 971.8695724487194, y: 1799.7954039495426 },
            { x: 966.2056122478546, y: 1799.3109033038245 },
            { x: 960.6267051850703, y: 1798.1824905674196 },
            { x: 955.2196736401605, y: 1796.42772679271 },
            { x: 950.0413272641232, y: 1794.0650486240538 },
            { x: 945.1662695742649, y: 1791.12713578678 },
            { x: 940.6581338155374, y: 1787.6523363249767 },
            { x: 936.624860830536, y: 1783.6507645422996 },
            { x: 933.0252424448142, y: 1779.2505055937922 },
            { x: 929.9023445515508, y: 1774.5042042494074 },
            { x: 927.3898784274219, y: 1769.396853341748 },
            { x: 925.4763662480268, y: 1764.0362572500646 },
            { x: 924.1867847412273, y: 1758.4923868641172 },
            { x: 923.5383806727704, y: 1752.8448424245673 },
            { x: 923.5375535419221, y: 1747.1601977260364 },
            { x: 924.1855489097744, y: 1741.5053218368494 },
            { x: 925.4743237551186, y: 1735.9612638720664 },
            { x: 927.387055933348, y: 1730.6003894160444 },
            { x: 929.8987788978152, y: 1725.4926729919823 },
            { x: 933.0209861586216, y: 1720.745917307936 },
            { x: 936.6199642569239, y: 1716.3451346520114 },
            { x: 938.6652814617036, y: 1714.3153028529232 },
            { x: 1003.6953654387094, y: 1710.617940218779 },
            { x: 1008.001180230991, y: 1714.2706240721839 },
            { x: 1011.8448059756873, y: 1718.458908585847 },
            { x: 1015.1902091940289, y: 1723.0638837894257 },
            { x: 1017.9885245438652, y: 1728.020389667737 },
            { x: 1020.2007911398555, y: 1733.256902108374 },
            { x: 1021.8037655272151, y: 1738.718403040566 },
            { x: 1022.7725012335451, y: 1744.319897230866 }
        ]
        const litpoly: any = [
            { x: 938.6652814617036, y: 1714.3153028529232 },
            { x: 940.6526549599525, y: 1712.3429760598058 },
            { x: 945.1602850784466, y: 1708.8675206891082 },
            { x: 950.0349152426113, y: 1705.9288985491453 },
            { x: 955.2129177879103, y: 1703.5654669424046 },
            { x: 960.6196939528133, y: 1701.8099164488788 },
            { x: 966.1984367695043, y: 1700.680691978685 },
            { x: 971.8623264142877, y: 1700.1953672169052 },
            { x: 977.5446322748172, y: 1700.3584197853406 },
            { x: 983.1713727338595, y: 1701.1677267970847 },
            { x: 988.6761837368355, y: 1702.614991506936 },
            { x: 993.9799896428165, y: 1704.6807025783457 },
            { x: 999.007353799081, y: 1707.3341523466638 },
            { x: 1003.6630761174234, y: 1710.5905487288549 },
            { x: 1003.6953654387094, y: 1710.617940218779 }
        ]
        test('should split Polygon by two points', () => {

            // Arrange  
            const PolyCoordinates: IVector2D[] = [
                { x: 1023.0968206437487, y: 1749.9952829404767 },
                { x: 1022.7725012335452, y: 1755.6706686500868 },
                { x: 1021.8037655272152, y: 1761.2721628403867 },
                { x: 1020.2007911398557, y: 1766.7336637725787 },
                { x: 1017.9885245438655, y: 1771.9701762132158 },
                { x: 1015.1902091940294, y: 1776.9266820915273 },
                { x: 1011.8493941933078, y: 1781.5260452173998 },
                { x: 1008.0063778957731, y: 1785.71488894444 },
                { x: 1003.6688092888228, y: 1789.3955954544365 },
                { x: 999.0135608340503, y: 1792.6526692220684 },
                { x: 993.9865828149626, y: 1795.3068504570806 },
                { x: 988.6830775315498, y: 1797.3733332244117 },
                { x: 983.1784771676884, y: 1798.821398883504 },
                { x: 977.5518545245188, y: 1799.6315245923006 },
                { x: 971.8695724487194, y: 1799.7954039495426 },
                { x: 966.2056122478546, y: 1799.3109033038245 },
                { x: 960.6267051850703, y: 1798.1824905674196 },
                { x: 955.2196736401605, y: 1796.42772679271 },
                { x: 950.0413272641232, y: 1794.0650486240538 },
                { x: 945.1662695742649, y: 1791.12713578678 },
                { x: 940.6581338155374, y: 1787.6523363249767 },
                { x: 936.624860830536, y: 1783.6507645422996 },
                { x: 933.0252424448142, y: 1779.2505055937922 },
                { x: 929.9023445515508, y: 1774.5042042494074 },
                { x: 927.3898784274219, y: 1769.396853341748 },
                { x: 925.4763662480268, y: 1764.0362572500646 },
                { x: 924.1867847412273, y: 1758.4923868641172 },
                { x: 923.5383806727704, y: 1752.8448424245673 },
                { x: 923.5375535419221, y: 1747.1601977260364 },
                { x: 924.1855489097744, y: 1741.5053218368494 },
                { x: 925.4743237551186, y: 1735.9612638720664 },
                { x: 927.387055933348, y: 1730.6003894160444 },
                { x: 929.8987788978152, y: 1725.4926729919823 },
                { x: 933.0209861586216, y: 1720.745917307936 },
                { x: 936.6199642569239, y: 1716.3451346520114 },
                { x: 940.6526549599525, y: 1712.3429760598058 },
                { x: 945.1602850784466, y: 1708.8675206891082 },
                { x: 950.0349152426113, y: 1705.9288985491453 },
                { x: 955.2129177879103, y: 1703.5654669424046 },
                { x: 960.6196939528133, y: 1701.8099164488788 },
                { x: 966.1984367695043, y: 1700.680691978685 },
                { x: 971.8623264142877, y: 1700.1953672169052 },
                { x: 977.5446322748172, y: 1700.3584197853406 },
                { x: 983.1713727338595, y: 1701.1677267970847 },
                { x: 988.6761837368355, y: 1702.614991506936 },
                { x: 993.9799896428165, y: 1704.6807025783457 },
                { x: 999.007353799081, y: 1707.3341523466638 },
                { x: 1003.6630761174234, y: 1710.5905487288549 },
                { x: 1008.001180230991, y: 1714.2706240721839 },
                { x: 1011.8448059756873, y: 1718.458908585847 },
                { x: 1015.1902091940289, y: 1723.0638837894257 },
                { x: 1017.9885245438652, y: 1728.020389667737 },
                { x: 1020.2007911398555, y: 1733.256902108374 },
                { x: 1021.8037655272151, y: 1738.718403040566 },
                { x: 1022.7725012335451, y: 1744.319897230866 }
            ]

            const points: any = [
                { x: 938.6652814617036, y: 1714.3153028529232 },
                { x: 1003.6953654387094, y: 1710.617940218779 }
            ]

            const cuttingService = new CuttingService()

            // Act
            const result = cuttingService.splitPolygon(PolyCoordinates, points)


            // Assert

            expect(result).toEqual({ big: Bigpoly, lit: litpoly })

        });

    });
    describe('splitPolygon', () => {
        const points = [
            { x: 1674.5604774154501, y: 2014.8495714300304 },
            { x: 1720.9737039910879, y: 1953.4694724766573 }
        ]

        test('get collision Points', () => {
            // Arrange
            const player = new PlayerBuilder()
                .setCoordinates([
                    { x: 1772.7426925061386, y: 2003.2235887005747 },
                    { x: 1772.418373095935, y: 2008.8989744101848 },
                    { x: 1771.4496373896052, y: 2014.5004686004847 },
                    { x: 1769.8466630022458, y: 2019.9619695326767 },
                    { x: 1767.6343964062555, y: 2025.1984819733138 },
                    { x: 1764.8360810564193, y: 2030.1549878516253 },
                    { x: 1761.4952660556978, y: 2034.7543509774978 },
                    { x: 1757.6522497581632, y: 2038.943194704538 },
                    { x: 1753.351327439772, y: 2042.6714096299452 },
                    { x: 1748.6594326964403, y: 2045.8809749821664 },
                    { x: 1743.6324546773526, y: 2048.5351562171786 },
                    { x: 1738.3289493939399, y: 2050.60163898451 },
                    { x: 1732.8243490300783, y: 2052.0497046436017 },
                    { x: 1727.197726386909, y: 2052.8598303523986 },
                    { x: 1721.5154443111094, y: 2053.0237097096406 },
                    { x: 1715.8514841102447, y: 2052.5392090639225 },
                    { x: 1710.2725770474603, y: 2051.4107963275173 },
                    { x: 1704.8655455025507, y: 2049.656032552808 },
                    { x: 1699.6871991265132, y: 2047.2933543841518 },
                    { x: 1694.812141436655, y: 2044.355441546878 },
                    { x: 1690.3040056779275, y: 2040.8806420850747 },
                    { x: 1686.2265382076207, y: 2036.9196516708887 },
                    { x: 1682.622579446032, y: 2032.5140869439065 },
                    { x: 1679.5482164139407, y: 2027.7325100095056 },
                    { x: 1677.0357502898119, y: 2022.625159101846 },
                    { x: 1675.122238110417, y: 2017.2645630101626 },
                    { x: 1673.8326566036171, y: 2011.7206926242152 },
                    { x: 1673.1842525351603, y: 2006.0731481846653 },
                    { x: 1673.183425404312, y: 2000.3885034861344 },
                    { x: 1673.8314207721644, y: 1994.7336275969474 },
                    { x: 1675.1201956175084, y: 1989.1895696321646 },
                    { x: 1677.032927795738, y: 1983.8286951761424 },
                    { x: 1679.544650760205, y: 1978.7209787520803 },
                    { x: 1682.6183180276612, y: 1973.9389545403421 },
                    { x: 1686.2216357297798, y: 1969.5328654744626 },
                    { x: 1690.2985268223424, y: 1965.571281819904 },
                    { x: 1694.8061569408364, y: 1962.0958264492062 },
                    { x: 1699.6807871050012, y: 1959.1572043092433 },
                    { x: 1704.8587896503002, y: 1956.7937727025028 },
                    { x: 1710.2655658152032, y: 1955.038222208977 },
                    { x: 1715.8443086318941, y: 1953.908997738783 },
                    { x: 1721.5081982766776, y: 1953.4236729770032 },
                    { x: 1727.190504137207, y: 1953.5867255454386 },
                    { x: 1732.8172445962493, y: 1954.3960325571827 },
                    { x: 1738.3220555992252, y: 1955.8432972670337 },
                    { x: 1743.6258615052063, y: 1957.9090083384438 },
                    { x: 1748.6532256614707, y: 1960.5624581067618 },
                    { x: 1753.3455873553844, y: 1963.771340741913 },
                    { x: 1757.647052093381, y: 1967.4989298322819 },
                    { x: 1761.4906778380773, y: 1971.6872143459448 },
                    { x: 1764.8360810564188, y: 1976.2921895495235 },
                    { x: 1767.6343964062553, y: 1981.248695427835 },
                    { x: 1769.8466630022454, y: 1986.485207868472 },
                    { x: 1771.449637389605, y: 1991.946708800664 },
                    { x: 1772.418373095935, y: 1997.5482029909638 }
                ])
                .build()

            const line = new LineBuilder()
                .setStartPoint({ x: 1733.0451085804496, y: 1937.5054022564207 })
                .setEndPoint({ x: 1672.7310702117366, y: 2017.2689075433464 })
                .build()

            const cuttingService = new CuttingService()
            // Act
            const result = cuttingService.getcollisionPoints(player, line)

            // Assert

            expect(result).toEqual(points)

        })
    })
}); 
